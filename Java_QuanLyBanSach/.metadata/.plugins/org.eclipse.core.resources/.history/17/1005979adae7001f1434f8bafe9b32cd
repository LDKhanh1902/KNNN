package vn.DA_KNNN.Controller;

import java.sql.ResultSet;

import vn.DA_KNNN.Model.DataProvider;
import vn.DA_KNNN.Model.User;
import vn.DA_KNNN.View.MainView;

public class MainController {
	private MainView view;
	
	public MainController(MainView _view) {
		this.view = _view;
		
		this.view.getUserInfo().setText(User.getName());
		
		this.view.getBookCountValue().setText(getBookCount());
		
		this.view.getStaffCountValue().setText(getStaffCount());
		
		this.view.getStaffCountValue().setText(getStaffCount());

		this.view.getSoldBooksValue().setText(getSoldBooks());
		
		this.view.getRevenueValue().setText(getRevenue());
	}
	
	private String getBookCount() {
		String str = "";
		try(ResultSet rs = DataProvider.getInstance().view("SELECT COUNT(*) FROM book")){
			if(rs.next())
				str = rs.getString(1);
		}
		catch (Exception e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		
		return str +" cuốn";
	}
	
	private String getStaffCount() {
		String str = "";
		try(ResultSet rs = DataProvider.getInstance().view("SELECT COUNT(*) FROM employee")){
			if(rs.next())
				str = rs.getString(1);
		}
		catch (Exception e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		System.out.println(str);
		return str+" người";
	}
	
	private String getSoldBooks() {
		String str = "";
		String sql = "SELECT SUM(`Quantity`) AS 'Tổng' FROM `paydetails`";
		try(ResultSet rs = DataProvider.getInstance().view(sql)){
			if(rs.next())
				str = rs.getString(1);
		}
		catch (Exception e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		System.out.println(str);
		return str+" cuốn";
	}
	
	private String getRevenue() {
		String str = "0";
		String sql = "SELECT SUM(`Amount`) FROM `payment`";
		try(ResultSet rs = DataProvider.getInstance().view(sql)){
			if(rs.next())
				str = rs.getString(1);
		}
		catch (Exception e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		System.out.println(str);
		
		return str+" VND";
	}
}
