package vn.DA_KNNN.View;

import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public class BookSaleForm extends JPanel {
    private static final long serialVersionUID = 1L;
    private JTextField searchField;
    private JTable cartTable;
    private DefaultTableModel cartModel;
    private JLabel totalPriceLabel;

    public BookSaleForm() {
        setLayout(new BorderLayout(10, 10));

        // **1ï¸âƒ£ Thanh TÃ¬m Kiáº¿m**
        JPanel searchPanel = new JPanel(new FlowLayout(FlowLayout.LEFT, 10, 10));
        searchPanel.add(new JLabel("ğŸ” TÃ¬m kiáº¿m sÃ¡ch:"));
        searchField = new JTextField(20);
        searchPanel.add(searchField);
        JButton searchButton = new JButton("TÃ¬m");
        searchPanel.add(searchButton);
        add(searchPanel, BorderLayout.NORTH);

        // **2ï¸âƒ£ Giá» HÃ ng (Báº£ng)**
        String[] columns = {"TÃªn sÃ¡ch", "GiÃ¡ (VNÄ)", "Sá»‘ lÆ°á»£ng", "Tá»•ng giÃ¡", "XÃ³a"};
        cartModel = new DefaultTableModel(columns, 0);
        cartTable = new JTable(cartModel);
        JScrollPane scrollPane = new JScrollPane(cartTable);
        add(scrollPane, BorderLayout.CENTER);

        // **3ï¸âƒ£ Tá»•ng Tiá»n & NÃºt Thanh ToÃ¡n**
        JPanel bottomPanel = new JPanel(new BorderLayout());

        JPanel totalPanel = new JPanel(new FlowLayout(FlowLayout.RIGHT, 10, 10));
        totalPriceLabel = new JLabel("ğŸ’° Tá»•ng tiá»n: 0 VNÄ");
        totalPanel.add(totalPriceLabel);
        bottomPanel.add(totalPanel, BorderLayout.NORTH);

        JPanel buttonPanel = new JPanel(new FlowLayout(FlowLayout.RIGHT, 10, 10));
        JButton printInvoiceButton = new JButton("ğŸ–¨ï¸ Xuáº¥t HÃ³a ÄÆ¡n");
        JButton payButton = new JButton("ğŸ¦ Thanh ToÃ¡n");
        buttonPanel.add(printInvoiceButton);
        buttonPanel.add(payButton);
        bottomPanel.add(buttonPanel, BorderLayout.SOUTH);

        add(bottomPanel, BorderLayout.SOUTH);

        // **4ï¸âƒ£ Xá»­ LÃ½ Sá»± Kiá»‡n**
        searchButton.addActionListener(e -> searchBook());
        payButton.addActionListener(e -> processPayment());
        printInvoiceButton.addActionListener(e -> printInvoice());
    }

    /**
     * ğŸ“Œ TÃ¬m kiáº¿m sÃ¡ch
     */
    private void searchBook() {
        String keyword = searchField.getText().trim();
        if (keyword.isEmpty()) {
            JOptionPane.showMessageDialog(this, "Vui lÃ²ng nháº­p tá»« khÃ³a tÃ¬m kiáº¿m!", "Lá»—i", JOptionPane.ERROR_MESSAGE);
            return;
        }

        // ğŸ”¹ Giáº£ láº­p káº¿t quáº£ tÃ¬m kiáº¿m (dá»¯ liá»‡u máº«u)
        String bookName = "SÃ¡ch Máº«u " + keyword;
        int price = 50000;
        int quantity = 1;
        addToCart(bookName, price, quantity);
    }

    /**
     * ğŸ“Œ ThÃªm sÃ¡ch vÃ o giá» hÃ ng
     */
    private void addToCart(String bookName, int price, int quantity) {
        int total = price * quantity;
        cartModel.addRow(new Object[]{bookName, price, quantity, total, "âŒ"});
        updateTotalPrice();
    }

    /**
     * ğŸ“Œ Cáº­p nháº­t tá»•ng tiá»n
     */
    private void updateTotalPrice() {
        int total = 0;
        for (int i = 0; i < cartModel.getRowCount(); i++) {
            total += (int) cartModel.getValueAt(i, 3);
        }
        totalPriceLabel.setText("ğŸ’° Tá»•ng tiá»n: " + total + " VNÄ");
    }

    /**
     * ğŸ“Œ Xá»­ lÃ½ thanh toÃ¡n
     */
    private void processPayment() {
        if (cartModel.getRowCount() == 0) {
            JOptionPane.showMessageDialog(this, "Giá» hÃ ng trá»‘ng!", "Lá»—i", JOptionPane.ERROR_MESSAGE);
            return;
        }

        JOptionPane.showMessageDialog(this, "Thanh toÃ¡n thÃ nh cÃ´ng!", "ThÃ´ng bÃ¡o", JOptionPane.INFORMATION_MESSAGE);
        cartModel.setRowCount(0);
        updateTotalPrice();
    }

    /**
     * ğŸ“Œ Xuáº¥t hÃ³a Ä‘Æ¡n (chá»‰ hiá»ƒn thá»‹ thÃ´ng bÃ¡o)
     */
    private void printInvoice() {
        JOptionPane.showMessageDialog(this, "HÃ³a Ä‘Æ¡n Ä‘Ã£ Ä‘Æ°á»£c in!", "ThÃ´ng bÃ¡o", JOptionPane.INFORMATION_MESSAGE);
    }

    /**
     * ğŸ“Œ Cháº¡y form bÃ¡n sÃ¡ch
     */
    public static void main(String[] args) {
        JFrame frame = new JFrame("Há»‡ thá»‘ng BÃ¡n SÃ¡ch");
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setSize(800, 500);
        frame.add(new BookSaleForm());
        frame.setLocationRelativeTo(null);
        frame.setVisible(true);
    }
}
