package vn.DA_KNNN.View;

import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public class BookSaleForm extends JPanel {
    private static final long serialVersionUID = 1L;
    private JTextField searchField;
    private JTable cartTable;
    private DefaultTableModel cartModel;
    private JLabel totalPriceLabel;

    public BookSaleForm() {
        setLayout(new BorderLayout(10, 10));

        // **1️⃣ Thanh Tìm Kiếm**
        JPanel searchPanel = new JPanel(new FlowLayout(FlowLayout.LEFT, 10, 10));
        searchPanel.add(new JLabel("🔎 Tìm kiếm sách:"));
        searchField = new JTextField(20);
        searchPanel.add(searchField);
        JButton searchButton = new JButton("Tìm");
        searchPanel.add(searchButton);
        add(searchPanel, BorderLayout.NORTH);

        // **2️⃣ Giỏ Hàng (Bảng)**
        String[] columns = {"Tên sách", "Giá (VNĐ)", "Số lượng", "Tổng giá", "Xóa"};
        cartModel = new DefaultTableModel(columns, 0);
        cartTable = new JTable(cartModel);
        JScrollPane scrollPane = new JScrollPane(cartTable);
        add(scrollPane, BorderLayout.CENTER);

        // **3️⃣ Tổng Tiền & Nút Thanh Toán**
        JPanel bottomPanel = new JPanel(new BorderLayout());

        JPanel totalPanel = new JPanel(new FlowLayout(FlowLayout.RIGHT, 10, 10));
        totalPriceLabel = new JLabel("💰 Tổng tiền: 0 VNĐ");
        totalPanel.add(totalPriceLabel);
        bottomPanel.add(totalPanel, BorderLayout.NORTH);

        JPanel buttonPanel = new JPanel(new FlowLayout(FlowLayout.RIGHT, 10, 10));
        JButton printInvoiceButton = new JButton("🖨️ Xuất Hóa Đơn");
        JButton payButton = new JButton("🏦 Thanh Toán");
        buttonPanel.add(printInvoiceButton);
        buttonPanel.add(payButton);
        bottomPanel.add(buttonPanel, BorderLayout.SOUTH);

        add(bottomPanel, BorderLayout.SOUTH);

        // **4️⃣ Xử Lý Sự Kiện**
        searchButton.addActionListener(e -> searchBook());
        payButton.addActionListener(e -> processPayment());
        printInvoiceButton.addActionListener(e -> printInvoice());
    }

    /**
     * 📌 Tìm kiếm sách
     */
    private void searchBook() {
        String keyword = searchField.getText().trim();
        if (keyword.isEmpty()) {
            JOptionPane.showMessageDialog(this, "Vui lòng nhập từ khóa tìm kiếm!", "Lỗi", JOptionPane.ERROR_MESSAGE);
            return;
        }

        // 🔹 Giả lập kết quả tìm kiếm (dữ liệu mẫu)
        String bookName = "Sách Mẫu " + keyword;
        int price = 50000;
        int quantity = 1;
        addToCart(bookName, price, quantity);
    }

    /**
     * 📌 Thêm sách vào giỏ hàng
     */
    private void addToCart(String bookName, int price, int quantity) {
        int total = price * quantity;
        cartModel.addRow(new Object[]{bookName, price, quantity, total, "❌"});
        updateTotalPrice();
    }

    /**
     * 📌 Cập nhật tổng tiền
     */
    private void updateTotalPrice() {
        int total = 0;
        for (int i = 0; i < cartModel.getRowCount(); i++) {
            total += (int) cartModel.getValueAt(i, 3);
        }
        totalPriceLabel.setText("💰 Tổng tiền: " + total + " VNĐ");
    }

    /**
     * 📌 Xử lý thanh toán
     */
    private void processPayment() {
        if (cartModel.getRowCount() == 0) {
            JOptionPane.showMessageDialog(this, "Giỏ hàng trống!", "Lỗi", JOptionPane.ERROR_MESSAGE);
            return;
        }

        JOptionPane.showMessageDialog(this, "Thanh toán thành công!", "Thông báo", JOptionPane.INFORMATION_MESSAGE);
        cartModel.setRowCount(0);
        updateTotalPrice();
    }

    /**
     * 📌 Xuất hóa đơn (chỉ hiển thị thông báo)
     */
    private void printInvoice() {
        JOptionPane.showMessageDialog(this, "Hóa đơn đã được in!", "Thông báo", JOptionPane.INFORMATION_MESSAGE);
    }

    /**
     * 📌 Chạy form bán sách
     */
    public static void main(String[] args) {
        JFrame frame = new JFrame("Hệ thống Bán Sách");
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setSize(800, 500);
        frame.add(new BookSaleForm());
        frame.setLocationRelativeTo(null);
        frame.setVisible(true);
    }
}
