package vn.DA_KNNN.View;

import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import org.jdatepicker.impl.*;
import org.jfree.chart.*;
import org.jfree.data.category.DefaultCategoryDataset;
import org.jfree.data.general.DefaultPieDataset;
import vn.DA_KNNN.Components.DateLabelFormatter;
import java.awt.*;

import java.util.Properties;

public class RevenueView extends JPanel {
    private static final long serialVersionUID = 1L;
    private JTable revenueTable;
    private DefaultTableModel revenueModel;
    private JDatePickerImpl startDatePicker, endDatePicker;
    private JLabel lblTotalRevenue;

    public RevenueView() {
        setLayout(new BorderLayout(10, 10)); // Th√™m kho·∫£ng c√°ch gi·ªØa c√°c th√†nh ph·∫ßn

        // **1Ô∏è‚É£ B·ªô l·ªçc th·ªùi gian**
        JPanel filterPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 10, 10));
        filterPanel.add(new JLabel("T·ª´ ng√†y:"));
        startDatePicker = createDatePicker();
        filterPanel.add(startDatePicker);
        filterPanel.add(new JLabel("ƒê·∫øn ng√†y:"));
        endDatePicker = createDatePicker();
        filterPanel.add(endDatePicker);
        JButton btnFilter = new JButton("L·ªçc");
        filterPanel.add(btnFilter);
        add(filterPanel, BorderLayout.NORTH);

        // **2Ô∏è‚É£ Bi·ªÉu ƒë·ªì**
        JPanel chartPanel = new JPanel(new GridLayout(1, 3, 10, 10));
        chartPanel.add(createPieChartPanel()); // Bi·ªÉu ƒë·ªì tr√≤n: Lo·∫°i s√°ch b√°n ch·∫°y
        chartPanel.add(createBarChartPanel()); // Bi·ªÉu ƒë·ªì c·ªôt: Doanh thu theo th√°ng
        chartPanel.add(createLineChartPanel()); // Bi·ªÉu ƒë·ªì ƒë∆∞·ªùng: Xu h∆∞·ªõng doanh thu
        add(chartPanel, BorderLayout.CENTER);

        // **3Ô∏è‚É£ B·∫£ng doanh thu**
        JPanel tablePanel = new JPanel(new BorderLayout());
        String[] columns = {"Th√°ng", "Doanh thu (VNƒê)"};
        Object[][] data = {
                {"Th√°ng 1", 12000000}, {"Th√°ng 2", 15000000},
                {"Th√°ng 3", 18000000}, {"Th√°ng 4", 20000000}
        };
        revenueModel = new DefaultTableModel(data, columns);
        revenueTable = new JTable(revenueModel);
        JScrollPane scrollPane = new JScrollPane(revenueTable);
        tablePanel.add(new JLabel("üìä Doanh thu theo th√°ng", JLabel.CENTER), BorderLayout.NORTH);
        tablePanel.add(scrollPane, BorderLayout.CENTER);
        tablePanel.setPreferredSize(new Dimension(250, 200));
        add(tablePanel, BorderLayout.WEST);

        // **4Ô∏è‚É£ T·ªïng doanh thu & N√∫t ch·ª©c nƒÉng**
        JPanel summaryPanel = new JPanel(new FlowLayout(FlowLayout.RIGHT, 10, 10));
        lblTotalRevenue = new JLabel("üõí T·ªïng doanh thu: 65,000,000 VNƒê");
        JButton btnExport = new JButton("üìÑ In b√°o c√°o");
        JButton btnExit = new JButton("‚ùå Tho√°t");

        summaryPanel.add(lblTotalRevenue);
        summaryPanel.add(btnExport);
        summaryPanel.add(btnExit);
        add(summaryPanel, BorderLayout.SOUTH);

        // **5Ô∏è‚É£ X·ª≠ l√Ω s·ª± ki·ªán**
        btnExport.addActionListener(e -> exportToPDF());
        btnExit.addActionListener(e -> System.exit(0));
    }

    /**
     * T·∫°o Date Picker
     */
    private JDatePickerImpl createDatePicker() {
        Properties properties = new Properties();
        properties.put("text.today", "H√¥m nay");
        properties.put("text.month", "Th√°ng");
        properties.put("text.year", "NƒÉm");

        UtilDateModel model = new UtilDateModel();
        JDatePanelImpl datePanel = new JDatePanelImpl(model, properties);
        return new JDatePickerImpl(datePanel, new DateLabelFormatter());
    }

    /**
     * Bi·ªÉu ƒë·ªì tr√≤n - Th·ªÉ lo·∫°i s√°ch b√°n ch·∫°y
     */
    private JPanel createPieChartPanel() {
        DefaultPieDataset dataset = new DefaultPieDataset();
        dataset.setValue("Ti·ªÉu thuy·∫øt", 120);
        dataset.setValue("Kinh t·∫ø", 90);
        dataset.setValue("Khoa h·ªçc", 50);
        dataset.setValue("Truy·ªán tranh", 150);

        JFreeChart chart = ChartFactory.createPieChart("Th·ªÉ lo·∫°i s√°ch b√°n ch·∫°y", dataset, true, true, false);
        return new ChartPanel(chart);
    }

    /**
     * Bi·ªÉu ƒë·ªì c·ªôt - Doanh thu theo th√°ng
     */
    private JPanel createBarChartPanel() {
        DefaultCategoryDataset dataset = new DefaultCategoryDataset();
        dataset.addValue(12000000, "Doanh thu", "Th√°ng 1");
        dataset.addValue(15000000, "Doanh thu", "Th√°ng 2");
        dataset.addValue(18000000, "Doanh thu", "Th√°ng 3");
        dataset.addValue(20000000, "Doanh thu", "Th√°ng 4");

        JFreeChart chart = ChartFactory.createBarChart("Doanh thu theo th√°ng", "Th√°ng", "Doanh thu (VNƒê)", dataset);
        return new ChartPanel(chart);
    }

    /**
     * Bi·ªÉu ƒë·ªì ƒë∆∞·ªùng - Xu h∆∞·ªõng doanh thu
     */
    private JPanel createLineChartPanel() {
        DefaultCategoryDataset dataset = new DefaultCategoryDataset();
        dataset.addValue(10000000, "Doanh thu", "Th√°ng 1");
        dataset.addValue(12000000, "Doanh thu", "Th√°ng 2");
        dataset.addValue(15000000, "Doanh thu", "Th√°ng 3");
        dataset.addValue(18000000, "Doanh thu", "Th√°ng 4");

        JFreeChart chart = ChartFactory.createLineChart("Xu h∆∞·ªõng doanh thu", "Th√°ng", "Doanh thu (VNƒê)", dataset);
        return new ChartPanel(chart);
    }

    /**
     * Xu·∫•t b√°o c√°o PDF
     */
    private void exportToPDF() {

    }

    public static void main(String[] args) {
        JFrame frame = new JFrame("Th·ªëng k√™ doanh thu");
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setSize(1200, 700);
        frame.add(new RevenueView());
        frame.setLocationRelativeTo(null);
        frame.setVisible(true);
    }
}
